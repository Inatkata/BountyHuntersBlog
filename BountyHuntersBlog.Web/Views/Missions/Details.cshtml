@model BountyHuntersBlog.ViewModels.Missions.MissionDetailsViewModel

<h2>@Model.Title</h2>

@if (!string.IsNullOrWhiteSpace(Model.ImageUrl))
{
    <img src="@Model.ImageUrl" class="img-fluid rounded mb-3" alt="@Model.Title" />
}
<p>@Model.Description</p>
<p class="text-muted">
    @Model.CategoryName Â· @string.Join(", ", Model.TagNames ?? Enumerable.Empty<string>())
</p>

<div class="d-flex align-items-center gap-2 mb-3">
    <form asp-controller="Likes" asp-action="ToggleMission" method="post" class="d-inline">
        @Html.AntiForgeryToken()
        <input type="hidden" name="missionId" value="@Model.Id" />
        <button type="submit" class="btn btn-outline-primary btn-sm">Like</button>
    </form>
    <span>@Model.LikesCount</span> likes
</div>

<hr />
<h4>Comments</h4>

@if (User.Identity?.IsAuthenticated ?? false)
{
    <form asp-action="AddComment" method="post" class="mb-3">
        @Html.AntiForgeryToken()
        <input type="hidden" name="MissionId" value="@Model.Id" />
        <div class="mb-2"><textarea name="Content" class="form-control" rows="3" required></textarea></div>
        <button class="btn btn-primary btn-sm" type="submit">Add Comment</button>
    </form>
}
else
{
    <div class="alert alert-warning">Login to add a comment.</div>
}

@if (Model.Comments.Any())
{
    <ul class="list-group">
        @foreach (var c in Model.Comments)
        { @await Html.PartialAsync("_CommentItem", c, new ViewDataDictionary(ViewData) { { "MissionId", Model.Id } }) }
    </ul>
}
else
{
    <div class="text-muted">No comments yet.</div>
}