@model BountyHuntersBlog.ViewModels.Missions.MissionDetailsViewModel
@{
    ViewData["Title"] = Model.Title;
}

<h2>@Model.Title</h2>
@if (!string.IsNullOrWhiteSpace(Model.ImageUrl))
{
    <img src="@Model.ImageUrl" class="img-fluid mb-3" alt="@Model.Title" />
}
<p>@Model.Description</p>

<p>
    <strong>Category:</strong> @Model.CategoryName
    <span class="ms-2">
        @if (Model.TagNames?.Any() == true)
        {
            foreach (var t in Model.TagNames)
            {
                <span class="badge bg-secondary me-1">@t</span>
            }
        }
    </span>
</p>

<form method="post" asp-action="ToggleMissionLike" asp-route-id="@Model.Id" class="d-inline">
    @Html.AntiForgeryToken()
    <button class="btn btn-outline-primary btn-sm" type="submit">
        Like (@Model.LikesCount)
    </button>
</form>

<hr />
<h4>Comments (@Model.Comments.Count)</h4>

@if (User.Identity?.IsAuthenticated == true)
{
    <form method="post" asp-action="AddComment">
        @Html.AntiForgeryToken()
        <input type="hidden" name="MissionId" value="@Model.Id" />
        <div class="mb-2">
            <textarea name="Content" class="form-control" rows="3" maxlength="1000" required></textarea>
        </div>
        <button class="btn btn-primary btn-sm" type="submit">Add Comment</button>
    </form>
}

<ul class="list-group mt-3">
    @foreach (var c in Model.Comments)
    {
        <li class="list-group-item">
            <div class="d-flex justify-content-between">
                <div>
                    <strong>@c.UserDisplayName</strong>
                    <small class="text-muted"> â€” @c.CreatedOn.ToLocalTime()</small>
                    <div>@c.Content</div>
                </div>
                <div>
                    <form method="post" asp-action="ToggleCommentLike" asp-route-id="@c.Id" asp-route-missionId="@Model.Id" class="d-inline">
                        @Html.AntiForgeryToken()
                        <button type="submit" class="btn btn-outline-primary btn-sm">Like</button>
                    </form>

                    @if (c.CanDelete)
                    {
                        <form method="post" asp-action="DeleteComment" asp-route-id="@c.Id" asp-route-missionId="@Model.Id" class="d-inline">
                            @Html.AntiForgeryToken()
                            <button type="submit" class="btn btn-outline-danger btn-sm"
                                    onclick="return confirm('Delete this comment?');">
                                Delete
                            </button>
                        </form>
                    }
                </div>
            </div>
        </li>
    }
</ul>
