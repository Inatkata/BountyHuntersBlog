@model IEnumerable<BountyHuntersBlog.ViewModels.Missions.MissionDetailsViewModel.CommentItem>

@if (Model == null || !Model.Any())
{
    <div class="text-muted">No comments yet.</div>
}
else
{
    <div class="list-group">
        @foreach (var c in Model)
        {
            <div class="list-group-item bg-dark text-white border-0 mb-2 rounded-3">
                <div class="d-flex justify-content-between">
                    <div class="d-flex align-items-center gap-2">
                        <i class="fa-regular fa-user-circle"></i>
                        <strong>@c.UserDisplayName</strong>
                        <small class="text-secondary">· @c.CreatedOnUtc.ToLocalTime().ToString("g")</small>
                    </div>
                    <div class="d-flex align-items-center gap-2">
                        @await Html.PartialAsync(
                            "~/Views/Shared/_LikeButton.cshtml",
                            new LikeButtonViewModel {
                                TargetType = "comment",
                                Target = LikeTargetType.Comment,   // back-compat за стария partial
                                TargetId = c.Id,
                                IsAuthenticated = User?.Identity?.IsAuthenticated ?? false,
                                IsLikedByCurrentUser = c.CanLike == false ? false : false, // оставяме false (репото връща реалното състояние при AJAX)
                                LikesCount = c.LikesCount
                            })
                        @if (c.CanDelete)
                        {
                            <form asp-controller="Comments" asp-action="Delete" method="post" class="m-0">
                                @Html.AntiForgeryToken()
                                <input type="hidden" name="id" value="@c.Id" />
                                <button type="submit" class="btn btn-sm btn-outline-danger">
                                    <i class="fa-solid fa-trash"></i>
                                </button>
                            </form>
                        }
                    </div>
                </div>
                <div class="mt-2">@c.Text</div>
            </div>
        }
    </div>
}
